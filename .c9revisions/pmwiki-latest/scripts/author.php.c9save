{"ts":1371754446321,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php if (!defined('PmWiki')) exit();\n/*  Copyright 2004-2009 Patrick R. Michaud (pmichaud@pobox.com)\n    This file is part of PmWiki; you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published\n    by the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.  See pmwiki.php for full details.\n\n    This script handles author tracking.\n*/\n\nSDV($AuthorNameChars, \"- '\\\\w\\\\x80-\\\\xff\");\nSDV($AuthorCookie, $CookiePrefix.'author');\nSDV($AuthorCookieExpires,$Now+60*60*24*30);\nSDV($AuthorCookieDir,'/');\nSDV($AuthorGroup,'Profiles');\nSDV($AuthorRequiredFmt,\n  \"<h3 class='wikimessage'>$[An author name is required.]</h3>\");\nMarkup('[[~','<links','/\\\\[\\\\[~(.*?)\\\\]\\\\]/',\"[[$AuthorGroup/$1]]\");\n\n$LogoutCookies[] = $AuthorCookie;\n\nif (!isset($Author)) {\n  if (isset($_POST['author'])) {\n    $x = stripmagic($_POST['author']);\n    setcookie($AuthorCookie, $x, $AuthorCookieExpires, $AuthorCookieDir);\n  } elseif (@$_COOKIE[$AuthorCookie]) {\n    $x = stripmagic(@$_COOKIE[$AuthorCookie]);\n  } else $x = @$AuthId;\n  $Author = PHSC(preg_replace(\"/[^$AuthorNameChars]/\", '', $x), \n                ENT_COMPAT);\n}\nif (!isset($AuthorPage)) $AuthorPage = \n    FmtPageName('$AuthorGroup/$Name', MakePageName(\"$AuthorGroup.$AuthorGroup\", $Author));\nSDV($AuthorLink,($Author) ? \"[[~$Author]]\" : '?');\n\nif (IsEnabled($EnableAuthorSignature,1)) {\n  SDVA($ROSPatterns, array(\n    '/(?<!~)~~~~(?!~)/e' \n      => \"FmtPageName('[[~\\$Author]] \\$CurrentTime', \\$pagename)\",\n    '/(?<!~)~~~(?!~)/e' \n      => \"FmtPageName('[[~\\$Author]]', \\$pagename)\"));\n  Markup('~~~~','<[[~','/(?<!~)~~~~(?!~)/',\"[[~$Author]] $CurrentTime\");\n  Markup('~~~','>~~~~','/(?<!~)~~~(?!~)/',\"[[~$Author]]\");\n}\nif (IsEnabled($EnablePostAuthorRequired,0))\n  array_unshift($EditFunctions,'RequireAuthor');\n\n## RequireAuthor forces an author to enter a name before posting.\nfunction RequireAuthor($pagename, &$page, &$new) {\n  global $Author, $MessagesFmt, $AuthorRequiredFmt, $EnablePost;\n  if (!$Author) {\n    $MessagesFmt[] = $AuthorRequiredFmt;\n    $EnablePost = 0;\n  }\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":2119}]],"length":2119}
